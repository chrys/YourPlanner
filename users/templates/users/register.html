<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    {% load crispy_forms_tags %}
    {% load i18n %}
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {% if has_default_professional %}
            {% trans "Customer Registration" %}
        {% else %}
            {{ page_title|default:"Register" }}
        {% endif %}
    </title>
    <link rel="stylesheet" href="{% static 'users/css/register.css' %}">
</head>

<body>
    <main>
        <div class="container">
            <h2 class="welcome-title">
                {% if has_default_professional %}
                    {% trans "Create Your Customer Account" %}
                {% else %}
                    {{ page_title|default:"Create Your Account" }}
                {% endif %}
            </h2>

            {% if has_default_professional %}
                <p class="text-center text-muted mb-4">
                    {% trans "Register as a customer to get started with our services." %}
                </p>
            {% endif %}

            <div class="form-container">
                <form method="post" id="registration-form">
                    {% csrf_token %}
                    <div class="form">
                        {{ form|crispy }}
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            {% trans "Register" %}
                        </button>
                    </div>
                </form>
            </div>

            <p>
                Already have an account?
                <a href="{% url 'users:login' %}">Log in</a>
            </p>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const roleField = document.getElementById('id_role');
            const titleFieldWrapper = document.getElementById('div_id_title');
            const weddingDayWrapper = document.getElementById('div_id_wedding_day');

            function toggleFields() {
                if (!roleField) return; // Exit if no role field (default professional case)

                const isCustomer = roleField.value === 'customer';
                const isAgent = roleField.value === 'agent';
                const isProfessional = roleField.value === 'professional';
                
                if (titleFieldWrapper) {
                    titleFieldWrapper.style.display = (isProfessional || isAgent) ? '' : 'none';
                    const titleInput = document.getElementById('id_title');
                    if (titleInput) {
                        titleInput.required = (isProfessional || isAgent);
                    }
                }
                
                if (weddingDayWrapper) {
                    weddingDayWrapper.style.display = isCustomer ? '' : 'none';
                    const weddingDayInput = document.getElementById('id_wedding_day');
                    if (weddingDayInput) {
                        weddingDayInput.required = isCustomer;
                    }
                }
            }

            document.getElementById('id_first_name').placeholder = 'First Name';
            document.getElementById('id_last_name').placeholder = 'Last Name';
            document.getElementById('id_email').placeholder = 'Email';
            document.getElementById('id_password').placeholder = 'Password';
            document.getElementById('id_title').placeholder = 'Title';

            // Initial state
            toggleFields();

            // Add change listener if role field exists
            if (roleField) {
                roleField.addEventListener('change', toggleFields);
            }
        });
    </script>
</body>
</html>