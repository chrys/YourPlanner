<div id="vasbot-app">
  <div class="vasbot-container">
    <!-- Widget Icon (Closed) -->
    <button
      v-if="!isOpen"
      class="vasbot-icon"
      @click="toggleWidget"
      aria-label="Open chat"
    >
      ğŸ’¬
    </button>

    <!-- Chat Window (Open) -->
    <div v-if="isOpen" class="vasbot-window">
      <div class="vasbot-header">
        <h3>VasiliasBot</h3>
        <button @click="toggleWidget" aria-label="Close chat">âœ•</button>
      </div>

      <!-- Messages -->
      <div class="vasbot-messages"><!-- CHANGED: FAQ list moved inside scrollable messages area so input always visible -->
        <div
          v-for="message in messages"
          :key="message.id"
          :class="['vasbot-message', `vasbot-${message.sender}`]"
        >
          <p v-text="message.text"></p>

          <!-- Feedback (bot messages only) -->
          <div v-if="message.sender === 'bot'" class="vasbot-feedback">
            <button
              @click="submitFeedback(message.id, 'up')"
              :class="{ active: message.feedback?.value === 'up' }"
            >
              ğŸ‘
            </button>
            <button
              @click="submitFeedback(message.id, 'down')"
              :class="{ active: message.feedback?.value === 'down' }"
            >
              ğŸ‘
            </button>
          </div>
        </div>

        <!-- Typing Indicator -->
        <div v-if="isLoading" class="vasbot-typing">
          <span>â€¢</span><span>â€¢</span><span>â€¢</span>
        </div>
        <!-- FAQ List (always show if available) -->
        <div class="vasbot-faqs" v-if="faqsLoading || faqs.length > 0 || faqsError"><!-- CHANGED: show container if loading, have data, or error -->
          <p>Popular questions:</p>
          <div v-if="faqsLoading" class="vasbot-faq-status"><span>Loading FAQs...</span></div><!-- CHANGED: loading indicator -->
          <div v-else-if="faqsError" class="vasbot-faq-status error"><span v-text="faqsError"></span> <button @click="fetchFaqs" class="vasbot-faq-toggle">Retry</button></div><!-- CHANGED: error + retry -->
          <!-- CHANGED: Removed v-for loop - FAQs will be rendered manually via JavaScript to avoid Vue reactivity issues -->
        </div>
      </div>

      <!-- Input -->
      <!-- CHANGED: Moved Download Transcript button to left and added FAQs button -->
      <div class="vasbot-footer">
        <button @click="downloadTranscript" class="vasbot-transcript-btn">ğŸ“¥ Download</button>
        <button @click="fetchFaqs" class="vasbot-faqs-btn">â“ FAQs</button>
      </div>
      <div class="vasbot-input">
        <input
          v-model="inputText"
          @keyup.enter="sendMessage(inputText)"
          placeholder="Ask me anything..."
          :disabled="isLoading"
        />
        <button @click="sendMessage(inputText)" :disabled="!inputText || isLoading">
          Send
        </button>
      </div>
    </div>
  </div>
</div>
